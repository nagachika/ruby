標準添付ライブラリ irb の builtin command の show_source でソーススクリプトファイルを 1行ずつ RubyLex に処理させてたのを全体を処理していから結果を解析するようにしています。 パフォーマンスのためとのことでこっちのほうが速いのか。なんとなく不要な処理をしなくて済む可能性があるので元のほうが効率的な気がしますが。

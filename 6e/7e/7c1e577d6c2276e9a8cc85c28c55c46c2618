gc_is_moveable_obj() で VALUE が指すオブジェクトが GC.compact で移動できるかの判定に pinned のフラグがついているかだけでなく GC の mark もついていることを条件に追加しています。 GC.compact は mark して(同時に移動できないオブジェクトは pin down して)行ないますが、GC は incremental に行なわれるので  pinned のフラグが立ってなくてもまだ確保してから mark がされてないだけという場合も考慮して mark されていることも条件にしているようです。 sweep phase が先に済んでしまうと実際は移動できるけど移動できないと判定することもありえるけど保守的に倒すということのようですね。

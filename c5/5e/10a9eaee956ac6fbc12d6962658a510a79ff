mark_ec_units() でループ回数を事前に計算してカウンタでループを回していましたが
、終了条件で break するようにして不要な変数を削除しています。この break する条
件を for 文の条件部(?)に反転して書いてもいいような。

8c908c989077c74eed26e02912b98362e509b8a3 で compile_array() にしたのと同様に compile_hash() の内容を詳細なコメントに追加し、最適化を動的な要素の後でも有効にしています。

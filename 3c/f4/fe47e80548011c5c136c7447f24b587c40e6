r43969, r43970 あたりの最適化で Array#uniq! で同一と判定された最後の要素が含ま
れるようになってしまっていたため Array#uniq と Array#uniq! で異なるオブジェクト
が含まれるようになっていたので内部で Hash に登録する時に登録済みだったら追加し
ないようにしています。 [ruby-core:59457] [Bug #9340]

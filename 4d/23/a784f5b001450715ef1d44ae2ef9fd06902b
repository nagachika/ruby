r51146 で追加された Kernel#exec で fd=3 のリダイレクトを指定するオプションのテ
ストが Solaris で失敗していたのを修正しています。 rb_exec_without_timer_thread
() を使って timer thread を殺して exec する処理は OS X と Haiku という OS での
み有効になっていましたが、全てのプラットフォームでこの戦略を取るようにしていま
す。r36009 で Leopard 以前の Mac OS X だとプロセスに複数のスレッドがいる状態で
fork(2) を呼ぶと ENOTSUPP がかえるのでタイマースレッドも一時的に止めるようにし
て、後に Haiku も同様のケアをするようにしていましたが、こうすると fd=3 のリダイ
レクト時にタイマースレッドがイベントを受け取ってしまう可能性があるので、常に止
めないといけないということみたいです。うーん、なんかタイマースレッドを止めると
それはそれでレースコンディションがあったみたいなことがあったような気もしますが
、なんだっけ…。signal まわりかな。 [ruby-core:69886] [Bug #11336]

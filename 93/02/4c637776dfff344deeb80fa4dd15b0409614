thread_pthread.c でマシンスタックのアドレスとサイズを取得するのに get_stack_of
() というマクロが使えたらそれを使うようにしています。この get_stack_of() という
のがどの環境で使えるものか検索しても出てこなかったのですが、ともあれ実行中のス
レッドではなくて、生成したスレッドでその pthread_t (thread_id) を渡して値を取得
するというインタフェースらしく(pthread_self() を渡してもだめなんでしょうね……)
native_thread_create() で th->interrupt_lock のロックを取得してからスレッド生成
して、スタックの情報取得後にロックを解放、生成されたスレッドでもロック取得/解放
を行なうことで、生成元のスレッドがスタックの情報をセットしてくれるのを待って先
に進むようにしています。

Marshal.load で Class, Module をロードする時にインスタンス変数つきになっている
と既存の Class, Module のインスタンス変数を上書きしてしまうため、チェックして禁
止(例外を発生)しているようです。 Marshal.dump では Class, Module は単に名前をダ
ンプして、load でもその名前を元に対応するそのプロセスでの既存のクラスを参照する
ようにするだけなのですが、フォーマット上インスタンス変数は修飾子的につけること
ができるので、わざとそのような文字列を作って Marshal.load に読ませると Class,
Module のインスタンス変数を設定、変更できてしまうという問題を対処している、と理
解しました。昨日の r38999 で記述されていたのと同様の問題の対応だと思います。
[ruby-core:51765] [Bug #7759]

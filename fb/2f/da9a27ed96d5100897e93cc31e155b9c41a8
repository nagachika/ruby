標準添付ライブラリ reline で case 文の when 節に正規表現を置いてマッチするかみてたのを、case 文の引数は指定せず when 節に String#[] でのマッチを直接書くようにしています。こっちのほうが高速らしい。

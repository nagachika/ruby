b62e9c912d744a1742a41be252855511f0a48032 の再修正。条件の論理式にかっこをつけてわかりやすくしています。

r43388 で ObjectSpace が複数の heap を持つことができるようにしたのを利用して、
Tomb heap という heap を追加しています。これは heap のひとつの page を sweep 後
にその中に生きているオブジェクトが1つもない状態になったら通常の heap (eden
heap) から Tomb heap に移動するようにしています。これによる page の解放の判定を
Tomb heap の page に対してのみ行うことで GC の負荷を下げようとしているみたいで
す。ついでに関数名の改名などをしています。
Tomb heap に所属する page だけ free のための判定をするから軽くなるってことかと
思ったのですが heap_pages_free_unused_pages() では変わらず全 page をみているの
で、違うみたいですねぇ。所属する heap のチェックを最初に行なってはいますがそれ
だけだとそれほど速くなるような気がしないので、もっと別の見落としている理由があ
るのかなあ。

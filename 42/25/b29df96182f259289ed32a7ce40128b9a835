拡張ライブラリ coverage で結果を格納する Hash オブジェクトを static 変数の
rb_coverage に保持して reset 時には中身のファイル毎の配列の clear (空配列にす
る)だけしていたのを、rb_vm_t::coverages だけみるようにして毎回新しい Hash オブ
ジェクトを使うようにしています。 [ruby-core:74596] [Bug #12220]
チケットで結構長い議論がありますがこれ確か何かしら理由があってファイル名を持ち
続けるようにしてたような気がするんですよね。同じファイルを Kernel#load で上書き
した時の挙動とかなにかあったような…。けど思い出せないのでまあいいか。

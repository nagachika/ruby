先日テストだけ追加されてた Windows 環境で IO#pos がファイルポインタを動かしてし
まうという不具合は、テキストモードで改行の後の時にだけ発生する問題だったようで
す。メソッドによってテキストモード/バイナリモードを切り替える時の処理に問題があ
ったようです。差分をみてもちょっと具体的にどの部分でファイルポインタの移動が起
きていたのかわからないですけど。バッファオーバフローの可能性があったのを修正し
ているというコミットログもあり、io_unread() で buf という変数を導入して新規にバ
ッファを割り当てるようにしている部分のことかと思うのですが、buf に確保している
メモリってどこで解放してるんでしょう。これリークしてないですかね。
[ruby-core:43497] [Bug #6179]

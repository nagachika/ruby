vm_method.c で OPT_GLOBAL_METHOD_CACHE が偽に定義されていた時の関数マクロ
GLOBAL_METHOD_CACHE() の定義に void 型の rb_bug() を使っているため、値のある式
とするために "," で繋げていたところを、マクロが展開された時にマクロの置換部分が
1つの式になるようにかっこで括って後に ",NULL" をつけるようにしています。
これ、元は 0,rb_bug(...) という定義になっていて、これがどう展開されるかというと
env = GLOBAL_METHOD_CACHE(klass, id);
が
env = 0,rb_bug(...);
となるので、env = 0 と rb_bug() を繋げた式となってたのですね。
けどこれだとマクロの展開の結果が呼び元の代入文などとくっついた結果1つの複文(複
式?)になっていてなんだか妙なので
env = (rb_bug(...),NULL);
と展開されるようにしてマクロ展開部分だけで1つの式になるようにしています。どこか
のコンパイラで警告になったのでしょうかね。

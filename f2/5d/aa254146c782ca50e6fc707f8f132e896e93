Array#index でオブジェクトの同値判定をする時に VM で Fixnum, Float, String など
の一部の組込みクラスのオブジェクト同士で、比較メソッドが再定義されていないの時
にメソッド呼び出しをしないショートカットの実装を利用するようにして最適化してい
ます。 [ruby-core:56809] [Feature #8820]
rb_equal_opt() が Qfalse を返した時に continue しているので ptr, len を再取得し
てない、と思いましたが rb_equal_opt() はメソッド呼び出しをしないためそのあいだ
に ary が書き変わることはないはずなのでそのケースでは再取得する必要がなく、最適
化版の比較ができなくてメソッド呼び出しに委譲した時だけ再取得するようにしている
ので、これで正しいのでした。

拡張ライブラリのロード時に ruby_xmalloc() のシンボルのアドレスを ruby 本体のも
のと比較して、異なっていたら別のバージョンの ruby 向けの拡張ライブラリなのでロ
ード失敗させるようにしています。
これは若干背景があって、rvm の機能で環境のバージョンを変更する機能があるそうで
、その時に既存の拡張ライブラリのパスが通ったままになるので古い(別の)バージョン
の ruby 用にビルドされた拡張ライブラリがロードされて SEGV するという現象の報告
がよく来るので、別の拡張ライブラリの対象のバージョンをチェックして弾きたいとい
う動機が前々からありました。その方法として ruby_xmalloc() を調べるというのを使
っているようです。これって libruby.so を利用している場合のみ有効なのかなぁ。

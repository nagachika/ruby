標準添付ライブラリ uri の URI::Generic#query= や #fragment= で不正なクエリ文字
列などを渡されると例外を発生させていたのを、%xx 記法でエスケープするようにして
います。これは RFC 3986 では "" などの文字が URI に含められなくなったため、
r46491 あたりで RFC 3986 対応した uri では "key=0&key[]=1" のように配列を指定す
るパラメータがエラーになるようになってしまっていたのでその対応として、不正な文
字はエラーではなくエンコードするようにしたとのことです。 [ruby-core:27360]
[Feature #2542]

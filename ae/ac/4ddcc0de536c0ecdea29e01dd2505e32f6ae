標準添付ライブラリ reline の Reline::LineEditor#calculate_nearest_cursor で入力が UTF-8 でない時に文字幅の検査のために分解する前に全体を UTF-8 に変換してたのをやめて各文字の幅をチェックする時に都度呼ぶようにしています。String#encode は新しい文字列を返すので別に元の方法でも良い気もしますが、途中でエンコード失敗するバイト列があった時のためとかでしょうか。

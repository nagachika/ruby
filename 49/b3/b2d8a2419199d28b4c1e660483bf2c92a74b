setup_fake_str() という ObjectSpace に属していないのだけど String オブジェクト
としての操作はしたい、というオブジェクトもどきを作る関数で struct RBasic::flags
に ELTS_SHARED を立てて共有されているようにみせていましたが、本当に欲しいのは解
放が不要であるということなので STR_NOFREE というフラグに変更しています。 r47639
あたりで(今年の9月)導入されたフラグなので、以前は解放を防ぐために ELTS_SHARED
を流用していたけど不要になったということでしょうか。

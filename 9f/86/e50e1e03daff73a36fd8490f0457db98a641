拡張ライブラリ fiddle の Fiddle::Pointer#to_ptr で引数が文字列オブジェクトの時に StringValuePtr() で変換後のオブジェクトを wrap という変数に再代入しておくようにしています。共有文字列などの場合にオブジェクトが変わることがあるのでそれに追随するため。

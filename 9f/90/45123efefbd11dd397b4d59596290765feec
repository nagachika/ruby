Hash の要素(key)を削除した時にそれが st_table::entries_start (テーブル内の開始要素)だった時にそれを +1 しておいたのを、そこも削除済みだった時に次に要素が残ってるところまでずらしておくようにしておくことで、大量に要素が消された後の Hash#first で不要なスキャンをなくして高速にしています。なるほど……。いやまあわかるけど Hash#first 自体そんなに使わないような気はする……。 [ruby-dev:51046] [Bug #17779]

r30852 で IO#close するとその IO オブジェクトについて操作中(read とか)の Thread
に IOError 例外が飛ぶようにしていましたが、実はちゃんと例外が飛んでいなくて、な
のに終了後に Thread#join すると例外が発生するようになっていました。別の Thread
へ例外を投げる時は rb_thread_t::thrown_errinfo に例外をセットしないといけないの
でそこを修正しています。なお Linux だと read() が -1 を返すので、改めて fd のチ
ェックをして別途 IOError が発生するのでちょっと見た目はちゃんと例外が発生するよ
うになっていましたが、Mac OS X では read() が 0 で返ってくるためそのまま処理が
続行していました(しかしその Thread を join すると IOError が発生する)。

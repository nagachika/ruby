Windows 版(cygwin 版?) で rubystub.exe という実行体をコンパイルして、これをスク
リプトファイルの先頭にくっつけて、rubystub.exe + shebang(#!ruby の行) + スクリ
プトの本体、というファイルを生成してインストールするようにしているようです。
Windows 版では .bat ファイルのかわりにこのようにして作った .exe ファイルをイン
ストールするようにしているみたいです。
また拡張子が .exe のファイルは自動的に -x オプション付きとして扱うように変更さ
れています。このため ruby.exe に渡せば #!ruby の行までを読み飛ばして続きをスク
リプトとして実行してくれるので、ただのスクリプトファイルとしても動くし、直接起
動しても rubystub が自分自身を引数として ruby インタプリタを起動するので実行で
きるというしくみではないか、というのがしばらく眺めていて辿り着いた結論です。ち
ゃんと納得いくまで読み込んだわけでないのでかなりの部分が推測です。
インストールされる全てファイルにインタプリタがくっつくとするとファイルサイズが
大きくなるんでしょうか。
この頃 Windows 環境のビルドなどの改善がとても進んでいるようですね。arton さんの
達人出版会の「Ruby環境構築講座 Windows編」を読んで勉強しようかなぁ。

こちらは Linux 用のスタックオーバフローチェックの不具合修正です。スタックの底
(というか天井というか、開始位置)のアドレスを計算するために
pthread_attr_getstack() で取得した base address を使っていたけど、これにスタッ
クサイズを加算しないといけなかった(スタックポインタはアドレスが減る方向に伸びて
いく)。また条件コンパイルの条件によって guard page のサイズがスタックサイズから
2重に減算されていたのを修正しています。 [ruby-core:24540] [Bug #1813]
もの凄く根本的な不具合ですね。rb_thread_t::machine_stack_start は Fiber の
FIBER_USE_NATIVE じゃない時にマシンスタックの退避のためにも利用されるのによく動
いてたなとか思います。多分この条件にあてはまる環境で動かしてないのだと思います
が……。

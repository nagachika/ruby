r47763 でエラー時の表示する情報を追加のみしていた IO#advice のテストで古い
Linux(3.6 より前。ってそんなに古くないような気も)の場合は tmpfs 上での fadvice
(2) が未サポートなので、Errno::EINVAL を無視させるようにしています。これ else
節で retry しているのは意図的なんですかね? カウンタとかないので無限ループになる
可能性があるような気が(別のプラットフォームで Errno::EINVAL が常に発生する場合
など)。 [ruby-core:65355] [Bug #10313]
[追記]fadvise(2) が tmpfs でサポートされないのは Linux カーネルのバージョンによ
る問題ではないのですが、EINVAL を返すという挙動は古いバージョンだけなのでそれを
対処しているということだそうです。コメント欄参照[/追記]

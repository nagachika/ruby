Range#bsearch による探索が Range の start end の値が Float の場合に浮動小数点数
の精度を意識した内容になっていなくて不要な yield を繰り返していたり、範囲外の数
値を yield していたので(こちらの理由はよくわかりませんが)、double を int64_t
(64bit 整数)にマッピングして二分探索するようにしています。 double の表現は IEEE
754 では(他の表現方法だとどうなんでしょう?) 符号ビット+指数ビット+仮数ビットと
なっているので、符号ビットを除くとあとは大小関係だけは整数として判定しても同じ
なのでこれでいいんだそうです。また中間値を取る時にオーバフローを考慮するように
しています。 [ruby-core:51563] [Bug #7724]

ついでに IO#write, syswrite などの出力する String は freeze した複製(変更がなけ
ればバッファは共有される)を作っておくようにしています。出力でブロック中に別の
Thread から変更されてしまうと SEGV などの危険があるからですね。しかし write す
るたびにオブジェクトを確保することになるのでパフォーマンスへの影響が心配ですね
。不幸なことではありますが freeze してから write に渡せば複製されないので、気に
するならそうするのかなぁ。 read の時と同じく temporary lock では駄目でしょうか
ね。[2012/2/29 追記]temporary lock だと同じ文字列を別々の Thread で IO#write な
どに渡すと失敗してしまうので駄目だったそうです。[/追記]

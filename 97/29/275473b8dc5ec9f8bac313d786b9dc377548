r46413 で(r46408 からの続き) rb_str_resize() でバッファサイズを切り詰めるときに
実際に realloc() を呼んだかどうかにかかわらず capa を len にそろえていたので、
REALLOC_N() を呼んだ時だけ capa を更新するように修正しています。

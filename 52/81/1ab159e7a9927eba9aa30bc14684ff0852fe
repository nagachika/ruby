T_TYPEDDATA 型のフラグに RUBY_TYPED_FREE_IMMEDIATELY というフラグを追加して、
T_DATA 型のオブジェクトの解放は遅延するようにしているのを、すぐに解放するように
指定できるようにしています。確かこれは finalizer から別の解放済みオブジェクトを
参照してしまうケースを救済するために即座にメモリ解放せずに遅延させるようにして
たのだったと思いますが……と思ったらちょっと違いました。 r43466 を参照。メモリ
使用量の抑制との兼ねあいで不要ならすぐに解放できるようにしようということでしょ
うか。
またついでに free 関数ポインタのデフォルトの xfree 関数を利用する値のマクロ
RUBY_DEFAULT_FREE を参照するようにするリファクタリングもあります。

RubyGems を更新しています。 gem cache ファイルの読み書きに flock でロックをかけ
るようにしたり、拡張ライブラリのインストール先ディレクトリをパッケージの指定で
変更できるようにしたりといった変更があったようです。
gem cache ファイルのロック理由として thread safety の為って書いてあるけど flock
(2) ってプロセス毎なんじゃ……と思いましたが、同じファイルを別の file
descriptor で開いてれば別々にロック取得できそうですから、多分そういうことなので
しょう。同じ IO オブジェクトを複数 Thread で触るならまあアプリ側で排他したほう
がいいでしょうしね。別の IO オブジェクトで fd が同じという可能性も……まあいい
か。

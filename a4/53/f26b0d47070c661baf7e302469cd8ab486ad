ece1690105b9e2887eeab36f67ad414049137ae2 のさらにリファクタリング。

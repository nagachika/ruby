短い文字列オブジェクトのバッファを struct RVALUE のスロット内に収める
STR_SET_EMBED() マクロで flags の STR_NOFREE をクリアするようにしています。ptr
で文字列のバッファを指さなくなるため。 StringIO でのメモリリークの修正というこ
となのですが、これは一旦文字列が truncate されて embed になっても NOFREE フラグ
が消えないまま、今度は文字列が伸長してバッファが確保されてもそれが解放されない
ため、でしょうかね。 [ruby-core:68436] [Bug #10942]

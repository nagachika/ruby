IO.copy_stream で rb_fd_init() で初期化するタイミングを早くしています。
rb_ensure() で終了処理から呼ばれる rb_fd_term() で初期化済み(確保済み)のメモリ
領域を開放する処理があるので rb_ensure() に入る前に初期化するようにしています。

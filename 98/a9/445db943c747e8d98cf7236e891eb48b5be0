同じく拡張ライブラリ json の Hash のエンコード時にキーを rb_funcall() で to_s メソッドを呼び出して文字列化していたのを、元々 String オブジェクトだった時と Symbol だった時はメソッド呼び出しを回避するようにしています。 JSON に渡すようなほとんどの場合でメソッド呼び出しを回避できるので結構速くなりそうですね。ベンチマークだと 20%弱くらい速くなってそう。

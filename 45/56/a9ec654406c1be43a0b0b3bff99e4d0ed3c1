r37991 の Hash リテラルが壊れる不具合修正をやりなおしています。 r37991 は修正方
法は合ってて assert() の入れかたが間違っていたみたいですね。どうも key => value
の key はリテラルで value がリテラルじゃない(正確には AST で NODE_LIT で表現さ
れるリテラルじゃない)時に key までで一旦切れて Hash にマージされて、その時に端
数になった最後の key が捨てられてそこから value -> key とずれてしまうみたいです
ね。っていってもそんな Hash リテラルいくらでもあると思うので発生条件はもう少し
複雑だと思いますが。ハッシュの要素数が大きい時に通るのかなぁ。 [ruby-dev:46658]
[Bug #7466]
[追記]なかださんに条件を教えていただきました。「ハッシュの要素が129以上で、129
個目以降のvalueに非NODE_LITがあり、それ以前がすべてNODE_LITのとき」とのこと。意
外になかなかそういうハッシュリテラルはないんですねぇ。[/追記]

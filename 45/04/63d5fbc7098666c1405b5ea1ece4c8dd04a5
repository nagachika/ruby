いくつかの修正が入っているようです。まず VM の GVL(Giant VM Lock でしたっけ)の
取得のAPIをリファクタリングしています。また pthread 版のロック取得のアルゴリズ
ムを新しいものに変更しています。元のものも条件コンパイル(GVL_SIMPLE_LOCK)で残さ
れています。新しいアルゴリズムでは GVL の取得待ちキューが用意されていて、待って
いる順番にロックを取得するようにされています。このため GVL には pthread_cond_t
も含まれるようになっています。これで GVL 取得でスレッドがスピンロック状態(ひと
つのスレッドが繰り返し GVL を[DEL:取得してはすぐ解放:DEL]解放してはすぐ再取得と
いうのを繰り返すことがありました)になるのを防いでいます。Windows 版はよく読んで
ないですが Mutex のロックだけのようです。[ruby-core:26694] [ruby-dev:42315]

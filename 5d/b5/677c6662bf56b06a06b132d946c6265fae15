String#encode に Encoding::UTF_16 や Encoding_UTF_32 のようなダミーエンコーディ
ングを渡すとエラーにならず Big Endian の BOM つきの文字列にエンコードするように
しています。Encoding オブジェクトではなくて "UTF-16" のように文字列渡しで指定し
た時は動いていたそうです。エンコーディングのインデックス指定の時に
ENC_INDEX_MASK でマスクしてダミーエンコーディングは無視させるようにしています。
[ruby-core:59354] [Bug #9314]

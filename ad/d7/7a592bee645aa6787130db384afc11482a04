IO の改行コード変換モードの処理の修正です。読み込み時と出力時のフラグを独立して
管理するようにして(これまでもしていたかもしれませんが)、標準出力や ARGF、pipe
で IO が binmode でない時に出力時の改行コード変換を
(TEXTMODE_NEWLINE_DECORATOR_ON_WRITE が定義済みなら == Windows 環境なら) CR+LF
モードにセットするようにしています。
標準出力や ARGF など一部の IO で出力時の変換が有効になっていなかったのを修正し
ているのだと思いますが、まあ正直なところよくわかりません。改行コード変換は仕様
からして複雑そうですね。そういえば JIS には改行コード変換の仕様は記載されている
のだろうか。特定プラットフォーム向け機能のような気がするので書いてないかな。

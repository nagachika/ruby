r55547 から r55557 あたりにかけての文字列の終端 NUL 文字のバイト数についての対
応のリファクタリングです。 rb_str_capacity() に termlen を引数に追加した
str_capacity() という関数を作って、埋め込み文字列オブジェクトに対して常に終端文
字を考慮する時に TERMLEN(str) でなく引数で指定されたバイト数を使うようにしてい
ます。また rb_str_change_terminator_length() という関数を追加して、終端文字のバ
イト数が変化した時(エンコーディングの変換などで)にバッファを拡張したり終端文字
部分を fill しなおしたりする処理を切り出しています。 [ruby-dev:49699] [Bug #
12536]

VM の命令列 iseq が内部的に保持する mark_ary というマークしておきたいオブジェク
トを追加するための配列を生成していたのを必要に応じて作るように遅延させています
。不要な Array オブジェクトを生成してスロットを消費することで GC 時間がかかって
しまうのを避けるようにしているのだと思います。 [ruby-core:53619] [Bug #8142]
struct rb_iseq_struct::mark_ary にはコンパイル時だけじゃなくインラインキャッシ
ュのデータも実行時に入れられるんですね。
これを読んでて iseq::compile_data にも mark_ary というのがあるのに気がつきまし
たが、こちらは使われていないような気がします。もう不要になったメンバでしょうか
。

r46408 で rb_str_resize() に現在と同じサイズを指定しても capa を切り詰めるよう
に…したつもりが realloc() が呼ばれていなかったのを修正しています。 capa が len
よりもある程度以上大きければ指定されたサイズ(終端文字のぶんを含む)に切りつめる
realloc() を呼ぶようにしています。
あれ、でも capa が len より少しだけ大きいときはそのままなのに、その後で capa =
len にしてしまっているので、実際のバッファサイズよりも capa が小さくなる可能性
がありますね。小さいぶんには大きな問題はないですけど(ObjectSpace.memsize_of が
不正確になるくらいか)。

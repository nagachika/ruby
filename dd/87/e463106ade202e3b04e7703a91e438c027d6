r41041 の vm_insnhelper.c での不要に見えた else 節が実は必要だったという部分に
ついてより詳しい解説をコメントとして残しています。ブロック呼び出しの途中の状態
で ruby のメソッド呼び出しが行なわれると VM のスタックポインタが呼び出そうとし
ているブロックへの引数の先頭を指している状態でメソッド呼び出しが行なわれてしま
い、そこで vm_push_frame() が呼ばれて最初の引数が上書きされてしまう可能性がある
ので、バックアップしておいてそこから復旧しておくようにしています。今まさにブロ
ックを呼び出そうとしている微妙な状態でメソッドを呼んでしまうからだったんですね
。 [Bug #8484]

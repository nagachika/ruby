e352445863588b90f7af6cdf6c1b6dc432ee33ab で Prev EP を GC.compact で移動可能にしたものの CI がエラーになったので 5ad2dfd8dce00f9fb4908adc786f12baaaf2b273 で revert したやつのリトライ。前回からの差分は gc_ref_update_imemo() で ep の指すオブジェクトを移動するのに VM_STACK_ENV_WRITE() を使ってたのを UPDATE_IF_MOVED() で直接書き換えるようにしています。 VM_STACK_ENV_WRITE() のほうだと内部の VM_ASSERT() などの assertion でオブジェクトの型のチェックをしていて、T_MOVED になっているとそこがひっかかってエラーになってしまってたそうです。 https://github.com/ruby/ruby/pull/2320

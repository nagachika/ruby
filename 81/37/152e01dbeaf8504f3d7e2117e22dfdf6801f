あまり詳しく調べていませんが rake でバックトレースのうち標準のライブラリパスの
ものを抑制するとかのために RbConfig から prefix, libdir などのキーワードでパス
を抽出してきていてその結果に重複があるのを Array#uniq で消すようにしています。
またテストでカレントディレクトリがその消されるパスに含まれていたら backtrace 関
連のテストを skip するようにしています。カレントディレクトリに一時ファイルを置
くのを止めたほうがいいんですけどね。

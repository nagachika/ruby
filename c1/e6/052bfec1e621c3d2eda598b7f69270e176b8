r38142 で revert された r38141 の再修正です。 r38141 でマシンスタックの保存を
rb_gc_save_machine_context() の中に入れたのとは反対に、
rb_gc_save_machine_context() の定義を消してその内容を関数マクロ
RB_GC_SAVE_MACHINE_CONTEXT() で直接展開されるようにしています。レジスタとスタッ
クポインタの保存はマクロを呼び出すスコープのものを保存しないといけないそうです
。1つ関数呼び出しが増えても効率別として不具合がおきるような問題にはならないよう
な気がするのですが、なぜでしょうか。
[追記]っていうのは大きな勘違いで、スタックポインタだけ保存してたってマシンスタ
ックの内容がレジスタの保存時と同じでないと意味がなく、関数から抜けるとその内容
が残る保証がないという問題でした。tarui さんがコメントで詳しく解説してくださっ
たのでそちらも参考に。[/追記]

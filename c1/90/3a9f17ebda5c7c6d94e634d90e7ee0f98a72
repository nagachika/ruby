r35391 で追加した IO のテストで pipe() というヘルパーメソッドを使うと別々のスレ
ッドでパイプの読み書きがされるので、IO#read_nonbock がタイミングによってエラー
になるので、with_pipe() を使って書き込みと読み込みを順に実行するようにしていま
す。

[ruby-dev:42212] で報告されたように、UTF-16 のようなマルチバイト文字列を puts
に渡すと末尾の1バイトしか見ていなくて改行の追加漏れが発生する件の修正。
あと、このテストの書きかただとパイプに先に書き込んでから読み込み用パイプから読
んでるのでブロックしてしまう可能性があります。test_io.rb にある pipe メソッドを
使って Thread を分けてあげないと環境によっては固まるようです(わたしのオフィスの
Linux だと何故か時々固まるんです)。

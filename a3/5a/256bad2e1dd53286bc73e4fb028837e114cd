Windows 版の win32_direct_conv() および rb_w32_readdir() でのファイル名のエンコ
ーディングの変換処理を変更しています。 UTF-8 への変換を行う場合は Win32 API を
使って直接変換するようにしているとのこと。うーむこの差分でどうしてそうなるのか
はよくわかりませんが、readdir_internal() などの関数の rb_encoding* を渡していた
引数に UINT cp (code page) を指定した変数へのポインタを渡すケースが増えていて、
引数の型が const void* になっています。あーこれまで NULL だった時は filesystem
encoding への変換の関数ポインタを渡していたのを UTF-8 の場合もそのパスを通すよ
うにして変換する cp を引数経由で渡すようにしたということか。引数が変換用の関数(
関数ポインタで渡される)への引数になるので、渡される関数ポインタによって内容が異
なるということですね。

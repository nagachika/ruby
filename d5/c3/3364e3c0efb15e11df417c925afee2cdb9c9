String#sub! で文字列オブジェクトの RSTRING_PTR() でポインタを取り出した後で実際に参照する前に repl と str が実は同じ String オブジェクトだと RESIZE_CAPA() でバッファが変更される可能性があるので、参照直前に取得するように修正しています。 [ruby-core:94356] [Bug #16105]

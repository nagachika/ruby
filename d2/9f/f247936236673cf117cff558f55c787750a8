拡張ライブラリ json で r43463 で導入された T_TYPEDDATA でデータ解放処理を遅延さ
せずにすぐ解放するように指定するフラグ RUBY_TYPED_FREE_IMMEDIATELY の利用や、
r46952 で導入された ZALLOC() という zero clear つきのメモリアロケータマクロが利
用されているなど古い ruby でのビルドができなくなるような変更が含まれてしまって
いたので、#ifdef で区切ったり代替実装を追加するなどの対応を追加しています。
upstream の json ライブラリとの乖離があったようで、そこに ruby の ext/json から
変更を取り込んでもらうために最新版に特化してしまっていた部分を対処しているよう
です。

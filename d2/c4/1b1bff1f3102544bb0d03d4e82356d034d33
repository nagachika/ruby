キーワード引数を m(**kw) のように定義した場合と呼び出す場合でそれぞれ呼び元と受け取るほうでそれぞれ Hash オブジェクトを作成するので、呼び出し時のフラグに情報を追加して既に呼び元で Hash が専用に確保されていたらそれを流用するようにして余分なオブジェクト生成を減らすようにしています。コミットログが長い。通常のキーワード引数と **kw みたいな Hash 渡しを混在させると呼び元で Hash は作るけど、**kw だけの時は余分な Hash オブジェクトは作らなくするようにしているそうです(そしてその場合呼ばれたメソッド定義のほうで **kw で受け取ってたら新たな Hash オブジェクトが作成されるけど、通常のキーワード引数のみの場合はそれも抑制される)。要するに呼び元の呼びかたとメソッド定義のしかたでそれぞれ Hash オブジェクトを確保する必要の有無があるけど、いずれにしても caller/callee あわせてたかだか 1つの Hash オブジェクトの確保ですむように情報を受け渡すようにしたということのようです。ところで **kw みたいな渡しかたって複数並べることができたんですね。

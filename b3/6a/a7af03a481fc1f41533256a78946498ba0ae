拡張ライブラリ objspace に ObjectSpace.total_memsize_of_all_objects が追加され
ています。また ObjectSpace.memsize_of というのが元々あって、このドキュメントが
少し修正されています。ちょっと前に T_DATA 型のオブジェクトには利用しているメモ
リサイズを報告する関数ポインタを持たせるように定義が拡張されていて、それに対応
しているオブジェクトは利用中のメモリサイズが分かるようになっています。それを
Ruby レベルで取得できるようにしています。

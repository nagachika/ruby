ary_new() でオブジェクトそのもの(struct RVALUE)の確保とバッファのメモリ領域の確
保の順番をいれかえて先にバッファのメモリ空間を得るようにしています。これはバッ
ファ用のメモリ空間を取得する瞬間に GC が発生して今確保したばかりのオブジェクト
が既に旧世代に昇格してしまっている可能性があるため FL_OLDGEN が立っているかもし
れないので、それを落とす作業が必要だったのを消すためです。
しかしこの順番にしてしまうとバッファのメモリ領域確保後に struct RVALUE を確保し
ようとしてそこで確保に失敗した場合 MemoryError 例外で抜けるのでバッファ部分がリ
ークしてしまわないでしょうか? rb_protect() とか rb_ensure() の利用が必要かと。

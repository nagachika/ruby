拡張ライブラリ socket の extconf.rb でプラットフォーム依存のライブラリチェック
(have_library) をヘッダのチェックの後に実行するように移動しています。

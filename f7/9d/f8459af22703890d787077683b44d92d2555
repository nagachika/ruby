test/ruby/enc/test_case_comprehensive.rb でデータファイルの全行を読んでから処理
してたのを1行ずつ読んで処理するようにして最適化しています。また String#=~ のか
わりに Regexp#match? を使うなどの中間オブジェクト生成を抑制する最適化などでテス
トを高速化しています。

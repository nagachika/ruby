[Bug #3910] で報告された SEGV する不具合の修正です。File オブジェクトが close
されずに GC で回収された時、正確にはその後 finalize 処理が走る時に、既に回収さ
れてしまっているかもしれない Mutex オブジェクトを使ってしまって SEGV していまし
た。いずれ Mutex オブジェクトではなく直接 rb_mutex_t を使うようにすべきだ、とコ
メントされています。finalize 処理で触ってはいけないオブジェクトに触ってしまうと
いう不具合は以前もありましたし、まだ潜んでいるかもしれませんね。
報告からほぼ 1時間で修正、瞬速でした。実はわたしもこれ ruby-dev にメールが流れ
てからちょっと調べてみてたんですが(ぎ、業務に関わるからですよ。現実逃避してたわ
けじゃないんだからねっ)原因を特定する頃には既に修正されてました。

GC.compact でオブジェクト移動させた時の参照の追随の処理でオブジェクトのインスタンス変数のテーブルの処理を別のコールバック関数を用意して、キーは実際にはオブジェクトではないので書き換えは行わないようにしている、みたいですがコールバック関数から return ST_REPLACE してるのはいいのかな。

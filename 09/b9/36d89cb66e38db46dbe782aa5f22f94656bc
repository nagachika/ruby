tool/mk_builtin_loader.rb で生成する C ソースコードの #line に埋め込むソースコード行数の基準になる行番号を固定で書いてたのを ruby スクリプト内の __LINE__ を基準に計算するようにしています。この間に C のソースコード出力以外の行を追加するとずれちゃうので注意ですね。

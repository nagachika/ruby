String#split にブロックを渡すとブロック内で正規表現マッチを使ってしまうとそれによって last_match が汚染されて分割に影響を与えてしまうので、ブロックが渡された場合は rb_match_busy() を呼んで保護するようにしています。 ブロック渡しは 2.6 からの機能で、単に分割結果を渡して yield するだけだけど、そのかわり結果を配列で返さなくなるので巨大な文字列を分割する時に巨大な配列をつくらなくて済むというやつですね。 [ruby-core:93940] [Bug #16024]

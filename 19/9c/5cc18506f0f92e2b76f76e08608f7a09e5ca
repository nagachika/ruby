C 言語の単項演算子 ~ は右辺値の整数を int に promote するとのことで unsigned
char 型の変数に適用した時に再代入するとオーバーフローが発生して未定義挙動になる
のを防ぐため、一旦 signed char を経由して明示的に最後 1 byte をマスクして取り出
すようにしています。コミットログに詳しい解説あり。

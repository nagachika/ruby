650cd245552d5c1abb244398b98d46ee280c4cd0 で切り出した get_digest_obj_metadata() から呼んでる get_digest_base_metadata() で取得したオブジェクトの型をチェックしてエラー処理するようにしています。ここの変更だとさっきの関数を切り出す必要は別になかったような気もする。まあついでかな。

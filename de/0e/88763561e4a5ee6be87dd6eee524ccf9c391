Enumerator::Lazy#take が返す Enumerator::Lazy にメソッドチェインしたメソッドの
ブロック内で同じオブジェクトを参照した時に評価結果がずれたり、Enumerator#next
で外部イテレータとして値を取得する特に途中で rewind で状態を巻き戻すと取得でき
る回数がおかしくなる不具合を修正しています。 NODE に埋め込んで関数の引数として
取り回していたカウンタをインスタンス変数として Enumerator::Lazy オブジェクトに
持たせるようにしているようです。でもこれでネストした時になぜうまくいくのかよく
わかりません。むしろインスタンス変数にしてしまうと同じオブジェクトで take の呼
び出しがネストするとまずそうですけど。 [ruby-core:51430] [Bug #7696]

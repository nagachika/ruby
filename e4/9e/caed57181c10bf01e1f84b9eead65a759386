Complex.polar の実装で cos(3), sin(3) の呼び出しを DBL2NUM() マクロの引数として直接渡していたので複数回呼び出され得るので一旦変数に格納して渡すようにしています。 また __sinpi() と __cospi() という組み込み関数があったらこちらのほうが最適化されやすい? のでこれを使うようにしています。
[追記]この変更はマクロの引数にするのを避けるためというより、sin(3) と cos(3) の呼び出しが連続して行なわれているとコンパイラが最適化して両方いちどに計算する関数呼び出しに展開してくれるという最適化が行なわれることがあるそうで、それを期待してのものだそうです。[/追記]

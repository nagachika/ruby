Process.kill で自分自身にシグナルを送信する時に、その受信は非同期に到達するので
、いつ SignalException が発生するかはわからなかったのですが、それを同期的に
kill した時に発生させるように、受信するまで待とうとしているようです。
rb_thread_cond_t を導入してシグナル受信もしくはその他の割り込みを待つようにして
いるみたいです。ただしメインスレッドで Process.kill した時だけみたいです。
[ruby-core:52864] [Bug #7951]
r39501 で一度はドキュメントのサンプルに追記してシグナルは非同期に受信するので
Process.kill してもすぐ SignalException が発生するとは限らないよという仕様を明
示するようにしてたと思うのですが、どういう心境の変化があったんでしょうか。あと
このあたりから puppet のテストが止まるようになったようなので、おそらくこの変更
が絡んでいるんじゃないかなぁという気がします(hsbt さん情報)。

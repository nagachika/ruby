標準添付ライブラリ pstore の PStore#transaction での例外処理が大雑把で
ThreadError を全て rescue で保続して PStore::Error で置き換えられていたのでもう
少し細かく条件を絞って再入をチェックするようにしています。また @lock の解放漏れ
を防ぐために ensure 節を追加しています。が、begin がこの位置で大丈夫かなぁ、と
思ったものの、前にしたらしたで @lock がロック済みかをチェックしないといけなくな
るわけで、けっこう難しいですね。非同期例外や Thread#kill で殺されないかぎりは大
丈夫のような気もします。 [ruby-core:39238] [Bug #5269]

pack/unpack で Float の変換時にコプロセッサの浮動小数点数(精度が 80bitあるので
、CPUのレジスタにある時と誤差の出方が違ってよくトラブルになる)が利用されてしま
って微妙にビットパターンが変わってしまうのを抑制するため、union を使って double
の値を char の配列としてアクセスする方法を取るように修正しています。
[ruby-core:74496] [Bug #12209]
以前図形演算やってた時によくこの問題にあたって一部のモジュールに -ffloat-store
を付けてコンパイルしたりしましたね…。

1.9.3 の新しい GC の実装 LazySweep では GC では mark をして実際の sweep は新し
くオブジェクトを割り当てる時に heap (オブジェクトの実体である struct RVALUE の
ひとかたまりの配列)毎に sweep 処理して空きができたらそれを利用するようにしてい
ますが、sweep すべき heap が存在していない時に mark 処理して再度空きを探す前に
新たな heap を確保するかどうかの判定をして、新しい heap を確保した場合は mark
はスキップして(新規に追加した heap は当然空の slot があるはずなので)空き slot
を使うようにしています。 GC の性能を改善しているようです。 [ruby-dev:44285]
[Bug #5127]
また sweep 予定の heap が残っている状態で再度 GC が走って mark 処理を開始する時
(GC.start などで強制的に GC を走らせる場合)に mark をクリアする際に必要なら
heap を追加するようにしています。

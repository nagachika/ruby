ここまでのデバッグの成果だと思いますが mkmf.rb で C++ 用モジュールに have_devel? メソッドを生やして C 用のメインのモジュールと状態が共有されないようにしています。

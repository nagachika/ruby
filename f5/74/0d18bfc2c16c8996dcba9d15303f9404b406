r60095 のリファクタリングを revert しています。最適化のための分岐まで消してしま
っていたので遅くなっていたそうです。

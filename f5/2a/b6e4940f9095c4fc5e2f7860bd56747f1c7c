拡張ライブラリ openssl の OpenSSL::PKey でパスワードつきの PEM から読む時に渡す
password の扱いを修正しています。この文字列には OpenSSL 側で受け付けるサイズの
制限があり(短すぎるのもだめらしい)、また NUL 文字を含めることができないので、
ossl_pem_passwd_value() という関数を導入してサイズチェックするようにしています
。ossl_pem_passwd_cb() でサイズも返しているところをみると NUL 文字は入ってたら
だめだけど NUL 終端である必要はないんでしょうね(StringValueCStr() を使う必要は
ない)。なんかちょっと不思議ですね。あと NUL 文字が入ってるとダメなのはチェック
していないような気が。テストをみるとそれはわざとなのか。 NUL 文字を考慮してサイ
ズチェックする必要はないんですかね? つまり "ab\0c" は len は 4 ですが NUL 終端
された文字列としてみると 2 なので、これは OpenSSL は弾くのかどうか、という。
https://github.com/ruby/openssl/issues/51

Array, Hash, Range, Struct などのネストした構造を持てるクラスの hash メソッドの
再帰チェックに rb_exec_recursive_outer() のかわりに rb_exec_recursive_paired()
を利用するようにしています。再帰チェックにひっかかった時にネストした構造の最も
外側のメソッド呼び出しに戻すのではなく、できるだけ内側までで留めて残りの処理を
続行するようにしているのだと思います。
また
a = []
a << a
[a].hash == a.hash
が true になる(無限再帰している構造が同一だと同一のハッシュ値になる)というテス
トケースを削除しています(実際にはテストは [a].hash ではなくて a.hash との比較に
なっていました)。おそらく実装上この仕様を保つのが難しいためこれまでは一緒だった
のを保証しなくしたのだと思います。

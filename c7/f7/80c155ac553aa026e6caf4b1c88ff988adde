たぶんヒアドキュメントのクオート内の改行を禁止したからできるようになったのだと思いますが parse.y の struct rb_strterm_heredoc_struct の構造体メンバーを変更して共用体内に入ってた lastidx を削除してマーカーの終端は offset, length などのメンバーから計算できるようにしています。またクオートの有無を保持する bit field quote や、どの種類の関数で処理するかを示す func というメンバーも増やしています。

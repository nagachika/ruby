拡張ライブラリ socket のテストで適当にポート番号を乱数で決める時に 49152 以上の番号を使っていたのを Windows 環境では 50000 以上からに変更しています。 Windows ではサービス群が若いポート番号を既に使ってることが多いので失敗しがち、ということみたいです。まあでも他の環境でもたまたま被ることはあってテストもそれを許容するように書かれてそうですが……と思ったけどよく参照されてるメールをみると test/socket/test_socket.rb のほうではなくて test/socket/test_addrinfo.rb のほうの random_port を使ったテストのほうで、さらに乱数の seed が固定されてるので常に失敗してしまうという問題だったようです。捕捉して無視する例外を決める errors_addrinuse で mingw の時だけ Errno::EACCESS を追加してたのを mswin でも追加するようにするのが良いんじゃないでしょうか。 [ruby-dev:42661]

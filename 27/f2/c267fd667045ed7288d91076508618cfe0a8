Array#reverse の実装でも RARRAY_PTR() を使っていたところを RARRAY_PTR_USE() を
使うように変更しています。
今度は配列サイズを最初に取得しているのですが、rb_ary_modify() から巡り巡って
ALLOC_N() が呼ばれる可能性があり、ここで GC が走る可能性があるので、そのあたり
でスレッドの切り替えや TracePoint のイベントフックなどで Ruby の処理が実行され
る可能性があって配列サイズが変化できると思うので rb_ary_modify() の後に
RARRAY_LEN() するほうがいいのではないかと思います。

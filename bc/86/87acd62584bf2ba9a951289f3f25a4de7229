fifo からの require 対策での GVL 解放にまつわる変更(r50887 および r52139)の続き
。 r52139 で load 用の fd を O_NONBLOCK つきで開いてしまっているため open(2) し
た後で fcntl(2) で flag をクリアするようにしています。通常のファイルでも
filesystem によっては(特に FUSE だと) O_NONBLOCK に指定されると挙動が変化する可
能性がある(すぐに読めない可能性がある)ので、残しておくのは危険とのこと。また
fifo の場合は読めるようになるまで待たないといけないので、やっぱり GVL を外して
open しなおすようにしています。その他 fifo からの load のテスト追加や条件分岐の
整理などリファクタリング。 [Bug #11060] [Bug #11559]

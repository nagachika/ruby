Hash の要素数が少ない時のテーブルによる実装になっているものに hash メソッドを呼ぶと st_table による実装に切り替えられる場合があり(なんでだっけ)、その場合 array hash 向けの処理の途中で st_table 向けの実装に切り替えないといけないことがあるので、RHASH_AR_TABLE_P() をチェックして分岐するようにしています。  [ruby-core:97383] [Bug #16676]

r61631 で拡張ライブラリ zlib の gzfile_write_raw() で書き込み後にバッファの文字
列オブジェクトを rb_str_resize() を読んではやめにメモリ解放させるようにする最適
化をしていましたが、ここでは write はメソッド呼び出しで読んでたので IO の実装と
は限らず、独自に write メソッドを実装したなにかかもしれないので、書き出した
String に対して破壊的操作をすると結果に影響する恐れがあったのでやめています。
Rack::Deflater がまさにこの影響で空のレスポンスを返してしまってたみたいです。
[ruby-core:90133] [Bug #15356]

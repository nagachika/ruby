posix_fadvise が利用できる環境で IO#advice メソッドが追加されています。
[Feature #4038]
posix_fadvise はカーネルに「これからこのファイルディスクリプタからこんなふうに
読み書きするんでよろしく(最適化してね)」という情報を通知するもので、シーケンシ
ャルに読むから先読みして欲しいとかランダムアクセスだからあんま先読みしても意味
ないよとか、そういうのを教えてあげるとカーネルがうまくやってくれてパフォーマン
スが良いかもしれない、というようなやつです。advise(:sequential) のようにシンボ
ルで指定するみたいです。
ruby-core でパッチが飛び交ってる時にちゃんと読んでなかったので今更ですが、シン
ボルを typo したり、その環境でサポートされていないものを渡してしまったりした時
に何も言わず nil を返すのでそれは raise してくれるほうがいいかなぁと思いました
。テストをみるとそこは意図的みたいですけど。

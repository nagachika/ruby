String#upcase, #downcase, #capitalize および ! つきの破壊的メソッドで rb_str_casemap() が新たに確保した String オブジェクトを返すようになっているのでそれを利用して余計な中間オブジェクトの生成を抑制するようにしています。このため ! なしのメソッドの実装は String を複製してから rb_str_xxx_bang() の関数に委譲するようになっていたのを、共通の処理をできるだけ関数に切り出すリファクタリングをして、それぞれのメソッドの実装を独立して書くようにしています。ベンチマークも追加されているのでパフォーマンス改善を目的とした変更みたいです。

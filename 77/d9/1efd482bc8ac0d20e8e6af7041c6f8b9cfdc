同じく obj[key]= のコンパイル時の最適化命令へのコンパイルの際、メソッドの戻り値
ではなくて代入の右辺値を評価値にするようにしています。
これは obj[key]= 型のメソッドのルールで、以下のような挙動をするはずが、最適化時
に対応漏れてたということですね。 [ruby-core:60071] [Bug #9448]
class A
  def []=(key, val)
    p [key, val]
    :ok
  end
end
a = A.new
a[:key] = 42
[:key, 42]
=> 42
>> a.send(:[]=, :key, 72)
[:key, 72]
=> :ok

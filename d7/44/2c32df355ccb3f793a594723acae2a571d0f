2.1 から追加された省略不可能なキーワード引数を最後の引数として持つメソッド定義
を仮引数をかっこで括らずに書くと、メソッド内容によって SyntaxError になる不具合
の修正として、parser や lexer にキーワード引数の key: の後を意味する状態を持た
せて、その後に改行が続いたらそこで切って行継続しているようにならないようにして
いるようです。これまでは EXPR_BEG だったため改行がきたら無視されていて次の行の
式がキーワード引数のデフォルト値として扱われてたみたいです。まじかー、と思って
テストはどうなってるか確認してみると、確かにメソッド定義は仮引数をかっこで囲ん
だ方法で定義しているのでこのケースはテストされていなかったようです。なるほど…
。これまで誰も気がつかなかったとは…と思いますが、無意識のうちに地雷原を避ける
能力が働いてしまったような気がします。確かにこれかっこ付けたくなるもんな…。
しかしチケットには、これでもまだダメだった、と書かれているので不完全な修正の模
様。 [ruby-core:61658] [Bug #9669]

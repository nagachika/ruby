r46859 のリベンジで Array#any? と Hash#any? の最適化バージョンの実装を追加して
Array と Hash は any? を独自に実装する方針に変更しています。なるほど、each の再
定義をチェックするのじゃなくて、Array#any? と Hash#any? は each を再定義しても
動作は変わらないようにしたという感じですね。
ところで、rb_ary_any_p() で最初に RARRAY_LEN() で配列サイズを取得して、それをそ
のままループに使っているんですが、rb_yield() を呼んでいるところで Ruby の処理に
入るので、配列のサイズがループ中に変化したり、RARRAY_CONST_PTR() もポインタの指
す先が変化する恐れがあるんじゃないでしょうか。

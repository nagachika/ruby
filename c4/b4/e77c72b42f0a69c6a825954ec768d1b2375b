r43050 の追加修正で "str" =~ /regexp/ の時も最適化により VM の命令から直接関数
を呼ぶのが Regexp#=~ が再定義されていても効いたままでメソッドが呼ばれない不具合
を修正しています。レシーバが String で引数(右辺)が Regexp の場合は
opt_regexpmatch2 という最適化命令にコンパイルされるので、こちらでも String#=~
メソッドの再定義チェックを行うようにしています。 [ruby-core:57385] [Bug #8953]
Regexp#=~ が再定義されているかはみなくていいのかなと思ったのですが、るりまの
String#=~ を読むと「other が正規表現でも文字列でもない場合は other =~ self を行
います」とあるので "str" =~ /regexp/ が Regexp#=~ を呼ばないで直接正規表現マッ
チを実行するのが仕様(というか現状)みたいです。ふーむ。

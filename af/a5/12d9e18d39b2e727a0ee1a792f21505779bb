Process.detach で子プロセスの終了を待つ Thread を内部的に生成してその pid メソ
ッドを特異メソッドとして生成していたのをやめています。かわりに Thread を継承し
て pid メソッドのみ追加した Process::Waiter クラスというのを導入して、作成した
Thread のクラスをこの Process:Waiter にすりかえることで pid メソッドが呼べるよ
うにしています。特異クラスを使い捨てられるオブジェクトに対して生成するとそれが
GC される時にメソッドキャッシュがクリアされて非効率なため、とのことですが今って
hierarchical method cache が導入されてるんじゃなかったっけ、と思ったけどパフォ
ーマンス悪化のため r43027 で revert されて今に至るって感じですね。
[ruby-core:64972] [Bug #10231]

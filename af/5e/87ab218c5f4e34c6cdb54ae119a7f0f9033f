Random に使う rb_random_t の宣言や rb_random_interface_t という新しい型を宣言する include/ruby/random.h というヘッダを追加しています。また RB_RANDOM_INTERFACE_DECLARE() や RB_RANDOM_INTERFACE_DEFINE() といったマクロを追加して独自の乱数生成器を C で定義するためのヘルパーを追加しています。 random.c での MT の実装もこのマクロを使って宣言するようにしています。

標準添付ライブラリ set の Set#replace で引数に渡されたオブジェクトが each_entry
もしくは each メソッドでイテレートできることを先に確認してから現在保持している
値をクリアするようにして、例外発生した時に既に空になってしまうのを避けるように
しています。 https://github.com/ruby/ruby/pull/675

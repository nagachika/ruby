string.c の rb_str_subseq(), str_substr() で struct RVALUE に文字列バッファを埋
め込む embeded モードにする文字列サイズの判定時に NUL 文字が複数バイトだった時
を考慮するようにしています。元々 1バイトぶんは余分に取ってあるのですが、終端文
字が複数バイトの時は超えてしまうのでそのぶん短い文字列しか埋め込めないようにし
ています。

コマンドラインオプション -i で引数のファイルの内容を書き変えるフィルタモードで出力先を別の拡張子をつけたファイルにおきかえる指定をした時に、拡張子を指定する文字列オブジェクトが変更され得るという問題があったみたいで、rb_fstring_cstr() で生成していたのを rb_str_new() に変更しています。

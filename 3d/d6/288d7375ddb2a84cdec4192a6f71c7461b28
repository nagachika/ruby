r64352 に続いて timer thread の廃止の修正。 GVL 解放してブロックする処理に入る
前にシグナルを受信してしまうと割り込みチェックの前にブロック処理に入って起床し
なくなるという問題を解決するための修正のようです。まず Thread のなかで timer
thread としての役割を受け持つ thread で、利用可能であれば timer_settime(2) シス
テムコールを用いた定期的なシグナル送信を行うようにしています。また gvl_yield()
時に常に blocking 中のスレッドを起こすようにしています。なんか前も思いましあが
Thread が多い時には timer thread がないかわりに全スレッドが定期的に起こされるの
で若干負荷が上がりそうな気がするんですがどうなんでしょう。 [ruby-core:88360]
[Misc #14937]

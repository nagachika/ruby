fork 時に Thread が存在しているとメインスレッド以外は止められますが、それが
Mutex の排他ロックを取得した状態だったらロックが解放されないままになって、その
Mutex のロックを取得しようとするとデッドロックしていました。 Thread の強制停止
時にロック取得している Mutex を解放しておくようにしています。これ、そういうもの
でしょうがないと思ってましたが解放できたんですね。もっとも MonitorMixin とか使
ってると Mutex とは別の(というか Mutex と ConditionVariable を利用して作った)機
構で排他処理してたりするのでそっちがデッドロックしてしまいますけど。まあでもそ
れは Ruby レベルなのでまだ救いはありますね。 [ruby-core:55102] [Bug #8433]

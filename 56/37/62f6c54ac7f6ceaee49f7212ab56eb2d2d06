do ... end 形式のブロックを Proc オブジェクトとして取り出して source_location
でソースコード上の位置を取ると行番号がずれていたのを修正しています。
[ruby-core:42232] [Bug #5930]

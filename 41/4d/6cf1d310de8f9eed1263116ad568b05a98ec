拡張ライブラリ psych のソースでブロックの途中で変数宣言しているところがあったので修正しています。今は C99 を使えるようになっていますが、psych は gem なので古い ruby でビルドすることもあるのでまだ C90 でビルドできるようにしておかないといけないということのようです。

Enumerable#take_while などで each に渡されたブロックをどこかに保存しておいてそ
のメソッドが終わった後に呼び出そうとすると SEGV などする不具合の修正をしていま
す。このブロックが VALUE を VALUE* などにキャストしてスタック上のメモリ領域をブ
ロックとの値受け渡しに利用するようになっているため、これらのブロックはスコープ
から抜けると正常に動作しないようになっていました。かわりにパース後の AST に利用
している NODE を確保してその子へのポインタ部分を利用するように変更しています。
NODE はオブジェクトの一種として GC の対象になっているのでそのブロックの Proc オ
ブジェクトが解放されると一緒に解放されるはずです。 [ruby-dev:45040] [Bug #5801]

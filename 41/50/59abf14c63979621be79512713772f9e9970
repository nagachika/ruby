IO.readlines や IO.foreach で separator や limit などの引数の解釈を1行の処理毎
に行なっていたので、最初に1回だけ行なって結果を渡すようにコールバック関数の切り
出しかたを変更しています。

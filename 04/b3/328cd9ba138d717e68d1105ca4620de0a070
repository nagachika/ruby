compile.c の iseq_set_sequence() の中で iseq->type の分岐のあちこちで行なってい
た VM スタックの深さの整合性チェックの部分を fix_sp_depth() という独立した関数
に切り出して、ise_set_sequence() の先頭で 1回呼び出しておくようにしています。
anchor のリストを 2回余分に辿ることになるけどエラー時には早く検出できますね。し
かしエラーじゃない時の速度のほうが優先されると思うので遅くなるようだと微妙です
ね。この部分は速度にはあまり影響しないという可能性もありますが。

ruby_qsort() の実装に qsort_s(3) というライブラリ関数があった時の実装で qsort_s
() は VC と glibc などの実装でちょっと異なっていたみたいなので __MSVCRT__ をチ
ェックして、さらに C のバージョンにも依存しているので __STDC_VERSION__ もチェッ
クするようにしています。 qsort_s() の利用は r54974 で主に Windows 環境向けに導
入されてて、それが他の環境でも使えるようになったけど微妙にインタフェースが違っ
てて問題が出てきてしまったみたいですね。 [ruby-core:88899] [Bug #15091]

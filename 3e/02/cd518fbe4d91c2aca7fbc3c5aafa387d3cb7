ruby 実装によるメソッド定義で Primitivie.func みたいなメソッド呼び出しにみせかけた C 関数呼び出しを利用したメソッドからの return イベントが TracePoint で発火しないという不具合の修正。C 関数を末尾呼び出ししてて opt_invokebuiltin_delegate_leave 命令を使う時に trace 版命令としては opt_invokebuiltin_delegate の trace あり版を使わないといけなかった模様。うーんこれってつまり trace 版に ISeq を書き換える時に opt_invokebuiltin_delegate_leave を使ってたところは opt_invokebuiltin_delegate + leave 命令になるんでしたっけ? この変更がそうするためのものなんだろうか(しかしこれで leave が追加されるような気がしないけど)。
[追記] 元々 opt_invokebuiltin_delegate_leave を使う場合でもその後に leave 命令が追加されるようにコンパイルされていたので、trace 化時に命令を変えるだけで leave に fallback できる状態だったそうです。 https://twitter.com/k0kubun/status/1275858824134459392 [/追記]

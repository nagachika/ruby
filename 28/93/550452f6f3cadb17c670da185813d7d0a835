?a のような1文字文字列リテラルに不正な Unicode エンコーディングを渡した時のエラーがわかりやすい例外になるようにしています。結果として parser_tokadd_utf8() という関数は戻り値を判定する必要がある箇所がなくなったので戻り値を void に変更しています。

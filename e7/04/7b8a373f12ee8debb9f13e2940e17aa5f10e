Array#reject! や Array#delete_if のブロックを break で止めた場合に、それまでに
ブロックから真値を返して削除することになっている要素が消えない不具合を修正して
います。rb_protect() を使って break などのフロー制御の時も配列の操作を行うよう
にしています。例外で抜けたり throw catch で大域脱出しても有効です。こういう不具
合がまだあるんですねぇ。 [ruby-core:27366] [Bug #2545]
ただこの変更では途中で break しても、それより後の要素が残らなくなってしまうのは
ちょっと意外な気がします。テストは
a = [ 5, 6, 7, 8, 9, 10 ]
a.delete_if {|i| break i if i > 8; i < 7}
a # => [7, 8]
のようになっているのですが、こうすると a は [7, 8, 9, 10] になるのがいいように
思います。「ブロックから true を返した要素を消す」からブロックから返ってなかっ
たら消さないのかなぁと。

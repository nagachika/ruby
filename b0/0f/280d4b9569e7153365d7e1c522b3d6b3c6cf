Module#name でクラスやモジュールの名前を取得する時にはキャッシュとして ruby レベルでは見えない classpath や tmp_classpath といった名前のインスタンス変数(@ で始まらないので表には出てこない)をみるけど最初は T_MODULE の constant_tbl を検索してたのですが、初期化時にあらかじめ classpath をセットしておくようにしています。なんでこうしてなかったかというと、なんでなんだろ。昔もこのへん妙に複雑だなと思ったのですが、コミットみてるとたぶん bootstrap 時に String クラスが作られる前に文字列のオブジェクトをセットしないといけないので fstring を使うとかしているので、そのへんに理由がありそうです。 [ruby-core:92253] [Feature #15765]

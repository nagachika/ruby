インスタンス変数用テーブルの更新時にサイズを変更する時にそのインスタンスでまだ使っていないインスタンス変数のぶんもあらかじめ必要になると見込んでクラスの index_tbl のサイズぶん確保しておくようにしています。メモリ使用量は増える可能性はあるけどインスタンス変数を新しくセットする都度 realloc するオーバーヘッドを減らせるので常識的な使い方であればメモリ使用量もそれほど増えず速度を改善できるという見込みでしょうね。

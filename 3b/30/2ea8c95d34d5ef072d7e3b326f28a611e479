Module#ruby2_keywords という private メソッドを追加して、public/protect/private のようなメソッド群と同様にメソッド名の Symbol を受け取ってそのメソッドは rest 引数で受け取った引数を別のメソッド呼び出しに splat 引数(*args のように配列を展開して渡す記法)で委譲した場合に、元のメソッドを keyword splat で受け取ってたらその属性を残して最後に呼ばれたメソッドでも keyword 引数として扱う? という仕様にするようにしています。これはつまり古い挙動のメソッドをこれをつけることで 2.7 でも保持できるようにするってことかな。実装でちょっとおもしろいのは、この仕様だと情報をメソッド呼び出しをまたがって伝播しないといけないので struct RHash のフラグに新しいビットを追加して Hash オブジェクト自体に元が keyword splat かどうかという情報を持たせるようにしています。なんかちょっと意図しない伝播がないか気になるけど。

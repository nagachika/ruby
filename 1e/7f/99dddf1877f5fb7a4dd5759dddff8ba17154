Module#autoload によるスクリプトのロードが thread safe でない問題の対応です。こ
のコミットは commit log がものすごく詳細に書かれているので、解説不要なくらいで
す。まあでも一応日本語の解説をしておくと、これまでは autoload が設定された定数
は定数テーブルの中で Qundef という CRuby の内部で未初期化値として使っている定数
(Ruby スクリプトからはこの値が見えることはないです)を未ロードを示すために格納し
ていて、それをみて指定されたスクリプトを読み込むのですが、それを実行したスレッ
ドが class/module 文で定数に Class/Module を格納したけどまだ class/module の定
義が完全じゃない時に他のスレッドがそれを参照してしまう可能性がありました。そこ
で autoload の動作を開始したら Qundef をロード予約を意味する専用の値で置き換え
て、ロードが完了するまではロードしている Thread しかその定数にアクセスできない
ようにしています。 [ruby-core:20797] [Bug #921]
多分 RB_GC_GUARD(load) の位置はもう少し下(ele を最後に利用した後)のほうがいいと
思います。

Enumerable#reverse_each でブロックの呼び出し中に receiver が破壊的に変更されて要素数が減る可能性があるのに RARRAY_LEN() で取得したサイズをそのまま使い続けるようになっていて異常終了する恐れがあったのを修正しています。サイズが小さくなるとインデックスがサイズ内に収まるように調整するので、yield するたびに先頭を削っていくと何度も末尾の要素を yield するという。ただここで削るべきは内部で生成される Array オブジェクトなので、普通はそんなことはないと思いますが(テストも ObjectSpace を使って無理矢理やっている)。 [ruby-dev:50867] [Bug #16354]

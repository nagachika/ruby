array.c で配列オブジェクトに埋め込みフラグ(要素数が少ない時にヒープ上にバッファ
を取らず struct RVALUE の空き領域を使って配列を実現していることを示すフラグ)を
セットする時に freeze されていないことをチェックする assert() 文を削除していま
す。
また rb_ary_modify() で ARY_SET_CAPA() を呼ぶ前に共有化フラグをクリアするように
しています。 ARY_SET_CAPA() が共有化されていないことを前提としているため。
おそらくこのあたりは ARRAY_DEBUG を有効にして(= assert 文を有効にして)ひっかか
ったところを修正するためだと思います。

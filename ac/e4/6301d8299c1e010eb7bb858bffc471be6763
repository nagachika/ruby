FileUtils のリファクタリング。メソッドの :mode, :noop, :verbose などのオプショ
ンへの対応を保持する OPT_TABLE の格納をまとめた define_command というユーティリ
ティメソッドを追加して、これを利用してメソッドの module_function 定義するように
しています。また FileUtils.compare_stream で IO#read の第2引数にバッファを渡す
書きかたをやめてサイズだけ指定するようにしています。これはなんとなく先日 r34580
などで修正した、IO#read が途中で割り込まれた時に指定サイズの文字列が見えてしま
う問題の対策っぽいですが、それは修正済みなのでバッファの文字列は使い回すほうが
大きなファイルでは若干効率的ですね。あとメソッドを private にするのを private
メソッドにメソッド名を渡して宣言するようにしていたのを無引数の private, public
を使って宣言している位置によって分けるようにしています。これはひとつづつ定義す
るほうが好みですねぇ。

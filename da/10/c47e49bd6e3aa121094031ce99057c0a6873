Array#sample の実装で RARRAY_PTR() を使っていて配列が Shady になっていたところ
を RARRAY_AREF() と RARRAY_PTR_USE() を使うようにしています。前半で rb_ary_elt
() を呼んでいるところは RARRAY_AREF() ではいけないのかな、と一瞬思いましたがこ
の前の RAND_UPTO() で Ruby の処理が呼ばれる可能性があるので配列サイズが変化して
しまっている可能性があるので再度インデックスがサイズの範囲内に収まっているかの
チェックが必要なんですね。また rb_ary_new{2,3,4} などの番号の関数名を意味のある
関数名の別名のほうを利用するようにリファクタリングしています。

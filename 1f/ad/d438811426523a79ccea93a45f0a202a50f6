Marshal.dump で T_OBJECT 型の内部的な id によるインスタンス変数をインスタンス変
数の数をカウントする時に除外するようにしています。ここで言う内部的というのは
"@" で始まってないというだけではなくて、Encoding の index や文字列表現に紐付か
ない(:E というのだけは例外みたいです。これはなんだろ) ID のことみたいです。
テスト用の拡張ライブラリで id_internal_ivar を明示的に初期化してないような気が
するんですけどこれはいいのかな? 0 に初期化されているのを使ってるということなの
かな。

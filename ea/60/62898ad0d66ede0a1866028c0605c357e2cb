Thread::Backtrace::Location で行番号を一度計算したら結果をキャッシュするようにするため内部的な状態を rb_backtrace_location_t::type の違いとして保持するようにしていましたが、これをやめて必要な時に毎回計算するようにしています。あまり頻繁に処理されるものではないからキャッシュしなくても影響は大きくないというのと、Thread::Backtrace::Location にカラム番号も保持したいのでその前準備としてとのことでした。まだ削ってないけど将来 type メンバーを削ってかわりにそのためのメンバーを増やすためかな。

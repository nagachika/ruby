ebd398ac5a4147a1e652d6943c39a29a62f12e66 で空けた struct RHash の VALUE 1つぶんのメンバーですが、これを Hash の array 実装をした時の hash 値の格納のために使うようにしています。といっても hash 値も VALUE 1つぶんいるのでそのままでは足りないので、なんとそれぞれの要素の下位 1byte だけを切り出してそれを格納(array hash 実装では要素数 8 までなので合計 8 bytes で sizeof(VALUE) が 8 の場合は足りると。すごいなぁ。小さい Hash の省メモリ化のためだと思います。また debug counters にこの切り詰めた hash の値による影響(一致したのに実は eql? じゃなかった、一致しなかったけど一致した)をカウントするようにしています。 [ruby-core:91530] [Feature #15602]

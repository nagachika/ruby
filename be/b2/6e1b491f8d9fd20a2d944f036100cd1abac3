VM の最適化についての修正です。四則演算や比較演算のような演算子のように見えるも
のは、Ruby では実際にはメソッドなのですが、Fixnum とか Float などの基本的なオブ
ジェクト同士の演算では本当にメソッド呼び出しをすると遅いので、VM の命令処理で最
適化が行われて組み込みの処理が実行されるようになっています。しかし Fixnum など
のクラスのメソッドでさえも再定義することが可能なので、もしも再定義されたらフラ
グを立てて、しかたないので実際のメソッド呼び出しをします。これまではこの再定義
フラグがメソッドの種類毎に管理されているだけだったので、たとえば Fixnum#+ を再
定義してしまうと 1.0 + 2.0 とか "aaa" + "bbb" など別のクラスの演算もメソッド呼
び出しになってしまっていたので、クラス毎の区別もビットフラグとして持つことで、
よりきめ細かく再定義済みかどうかを判定できるようにしています。
改造のネタはいろいろあるものですね。

1.9 から導入された -> {} で lambda のかわりにする文法が self に対して lambda メ
ソッドを呼ぶ命令としてコンパイルされていたために BasicObject に対して
(instance_eval を使って) -> {} を利用すると NoMethodError 例外になる不具合を修
正しています。と、言うことは lambda という名前でメソッドを定義したクラスのメソ
ッド内で -> {} を使うとそちらが呼ばれてしまうので -> {} で期待したのと違うもの
ができてしまっていたわけですね。 [ruby-core:42349] [Bug #5966]
self のかわりにレシーバとしてメソッド定義などの VM 内部の処理をさせるための内部
的なオブジェクトを利用するようにしています。
また FCALL (レシーバを書かずに関数っぽく呼ばれた時のメソッド呼び出し)や VCALL
の時に self をスタックに積まないようにしていましたがその必要はなくなっているよ
うなので常に self を積むようにしています。

class << obj; end という記法で特異クラスのメソッドなどを定義する時にこれも
namespace を導入するようにしています。 class << obj; end は普通の class C; end
や module M; end とは違って定数探索上の scope になっていなくてここで定数を定義
してもその外側のスコープに作られてしまっていたのを変更しています。実装はあまり
深く追ってませんが、rb_method_entry_t の iseq 情報に cref 情報も持たせるように
なったのと、メソッド呼び出し時の control frame の積み方を少し変更しているようで
す。method_entry に cref がのってるのってなんか変な気持ちですが、定義時の状態が
必要になるということなのでまあそりゃそうか。 [ruby-core:68437] [Bug #10943]

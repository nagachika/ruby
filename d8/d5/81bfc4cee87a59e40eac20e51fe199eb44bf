thread_sync.c の rb_mutex_owned_p() からメインのロック保持チェック部分を mutex_owned_p() という関数に切り出し、do_mutex_lock() から最後に抜ける直前にカレントスレッドが mutex を保持した状態になってるかチェックして不正だったら rb_bug() で異常終了するようにしています。デバッグのためかな。

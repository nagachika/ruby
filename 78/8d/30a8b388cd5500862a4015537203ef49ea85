0096d2b895395df5ab8696d3b6d444dc1b7730b6 で Range オブジェクトを生成時に freeze するようにした変更の続き。 VM 命令列の peephole optimization として文字列の Range を作るのに newrange 命令を利用していたら begin/end が静的な要素だったら直接 putobject で Range オブジェクトを積むようにしていたところで、まず checkmatch 命令をさがしてその前に newrange があったら最適化対象かどうかみるということをしていたのを直接 newrange 命令を検索するようにしています。つまり Range が freeze されるようになったので安全により広範な Range オブジェクト生成も同じ最適化ができるようになったということかと思います。 [ruby-core:90881] [Feature #15504]

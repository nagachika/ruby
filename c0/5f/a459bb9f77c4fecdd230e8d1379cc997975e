snprintf などの実装に使われる指示子をカスタマイズする ruby__sfvextra() という関
数で Symbol の時に NUL 文字や non-printable な文字、記号などを含まない識別子の
ような文字列で表現できないものの場合(まあつまりは :sym みたいなリテラルで表現す
る時に :"a b" のようにクオートが必要かどうかという判定かと思います)クオート付き
の文字列にするようにしています。

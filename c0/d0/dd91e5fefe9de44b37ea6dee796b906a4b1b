str_buf_cat() で RSTRING_PTR() や RSTRING_LEN() を毎回呼んでいるところをローカ
ル変数に代入して使いまわすようにしています。こういう時メモリ確保(の副作用として
の GC、の副作用としての finalizer 実行)などで Ruby のメソッドが呼ばれる可能性が
あると対象のオブジェクトが変更される可能性があるので気をつけないといけませんが
、rb_str_modify() の後と RESIZE_CAPA() の後は再取得しているので大丈夫そうですね
。と思ったけど RESIZE_CAPA() の後 olen は取り直していないけどこれは大丈夫ですか
ね。まさに操作中の文字列のサイズを弄られるとかだいぶ嫌な想定ですし、きっと考慮
済みでしょうけど。

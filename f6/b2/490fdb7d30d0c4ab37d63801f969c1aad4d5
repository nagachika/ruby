USE_VALUE_CACHE の条件コンパイルオプションを削除しています。これは rb_thread_t
あたりに Thread 毎に VALUE の配列をキャッシュとして持っていて、なにやら最適化の
為に使ったりするらしい雰囲気を醸し出していたものの、実際には使われていなかった
ものです。消すことになったようです。
[追記][ruby-dev:42522] にあるように、Thread が本当に並行に動く実装の時に、解放
したオブジェクトの struct RVALUE を使い回すためのものだったようです。freelist
を Thread 毎にする提案がされているので、パッチを読んで予習しておかねば。[/追記]

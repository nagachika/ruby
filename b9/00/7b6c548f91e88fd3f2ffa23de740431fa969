メソッドキャッシュの実装の変更と Class 毎のメソッドキャッシュの機構の導入。 インラインメソッドキャッシュの実体 struct rb_callcache を T_IMEMO 型のオブジェクトとして持つようにしてそのメモリ管理を GC にまかせるようにしています。マルチスレッドでの競合の問題をおきにくくするためとのこと。またメソッド再定義時のキャッシュの破棄に class_serial を使う手法のかわりに method entry 毎に直接破棄フラグを立ててキャッシュ破棄することでメソッド再定義時の影響範囲を狭くするようにしているようです。かなり大規模の変更なのでしばらくなにかと追加変更がありそう(Refinements がらみとか…)。 [ruby-core:97084] [Feature #16614]

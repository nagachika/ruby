RGenGC に3世代の世代別GCを導入しています。ただしデフォルトでは無効で、
RGENGC_THREEGEN を真に定義してコンパイルすると有効になるそうです。まだ不安定で
再現性のないエラーやパフォーマンスの悪化があるそうなので、デバッグやメモリ使用
量の評価に協力してくれる人は試してみてください、というステータスだそうです。
RGenGC には新世代(まだ GC を経験していない)と旧世代(1回以上GCを生き抜いた)の2世
代だけだったのですが、短命なオブジェクトがたまたま利用中に GC が走ると旧世代に
昇格してしまい、結果 major GC が実施されるまで回収されなくなってしまうために、
極端なケースでは大量のメモリを消費してしまうというのに対処しようとしているそう
です。これまでの FL_PROMOTED とは別に oldgem_bitmap を導入して、これで Infant
(まだ一度も GC を経験していない)、Young(一度 GC を生き残った(FL_PROMOTED が立っ
てる)けど oldgen_bitmap には追加されていない)と Old (2回以上 GC を生き残った)に
わけて、Infant と Young を minor GC の対象にすることで major GC でしか回収され
なくなる閾値を引き上げるというのが主なアイデアのようです。

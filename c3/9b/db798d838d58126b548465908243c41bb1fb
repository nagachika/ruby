徐々に対応するレベルが減らされてきた $SAFE ですが、この変更で Thread や Proc の
ブロック内毎に別の値を持っていたのを、プロセス全体で共通の値をみるようにしてい
ます。チケットのほうをみますと、これによりコンテキスト切り替え時の safe_level
の復旧が不要になるため、パフォーマンスを良くすることができるというのが動機みた
いです。 rb_execution_context_t::safe_level や rb_proc_t::save_level 等のメンバ
ーも削除されています。またそうすると $SAFE = 1 にするとずっと 1 のままだと困る
こともあるので、再代入でレベルを緩めることもできるようにしています。なるほどー
。まあ、$SAFE はいずれ消されるんだろうなという感じではありましたが、その前にも
う一段階置くって感じなんですかね…。 [ruby-core:84519] [Feature #14250]

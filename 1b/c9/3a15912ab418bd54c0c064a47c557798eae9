gc.c で新たにヒープを確保するかどうかの判定に free されたスロット数から逆算した
行きているスロット数を使っていたのを、マークされた数を保持するようにして、その
数をベースに計算するようにして不要なヒープ確保を避けるようにしています。多分で
すが Lazy Sweep によって、objspace_live_num() と実際にマークされて生きているオ
ブジェクト数に乖離が出るようになったのでこのように対処する必要ができたというこ
とでしょう。 [ruby-core:53393] [Bug #8093]

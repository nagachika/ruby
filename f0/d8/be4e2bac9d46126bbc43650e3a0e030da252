IO#close_write で rb_io_t fptr を閉じるのと、モードを変更する順番を入れ替えてい
ます。先に close してからモードを変更していたので、マルチスレッドで処理している
時に write_close と close で競合する可能性があったようです。 ruby-list ML に来
ていた IO.pipe についてのメールが発端でしたが本体のバグだったとは、まだこんなの
残ってるんですねぇ。 [ruby-list:49598]

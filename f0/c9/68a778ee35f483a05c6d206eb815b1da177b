Ruby の VM の命令列には once という1回だけ実行される処理のための命令があり、正
規表現の o オプションの実装のために利用されているのですが(r42637 で導入
[ruby-dev:45923] [Bug #6701])、この実装を iseq_inline_storage_entry::once::done
でフラグを持つのではなく、iseq_inline_storage_entry::once::running_thread に
0x01 というポインタとしてありえない値を入れることで実行済みを表現することで構造
体サイズを削っています。 exit するだけのプログラムで 10KB ほど使用メモリ量が削
減されたということで、割とインパクト小さい感じではありますが、inlinecache は
Rubyで書かれたメソッドとかが増えると増えていくので実用的なアプリケーションでは
もっと効果があるかもしれませんね。

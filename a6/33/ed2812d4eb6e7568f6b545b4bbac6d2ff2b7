xrealloc() でメモリ確保時に GC.stress が設定されていたら GC 実行するようにして
います。へー realloc のときは GC.stress による強制 GC は実行されてなかったんで
すね。 [ruby-core:62103] [Feature #9761] が、これは意外に影響が懸念されているよ
うでささださんが [ruby-dev:48117] で revert か変更の再修正を提言しています。 GC
.stress による GC が行われるだけでなくて、malloc_increase による圧力で GC 実行
も xrealloc() で起きるようになり、実は xrealloc() では GC が発生しないという前
提で書かれてしまっている部分があってそこでマーク漏れが発生してしまうんだそうで
す。えーそうだったのか…。

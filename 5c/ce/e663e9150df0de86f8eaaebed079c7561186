Windows 版の FD_SET() の実装を関数からマクロに変更しています。コミットログによ
ると FD_SETSIZE が拡張ライブラリで利用されていた時に、関数だと ruby 本体をコン
パイルした時のサイズのままで触ろうとしてオーバフローしてしまうので、拡張ライブ
ラリのコンパイル時に拡張ライブラリ毎にサイズを決めるようにしているのだと思いま
す。 [ruby-core:44588] [Bug #6352]
また rb_w32_select_with_thread() で copy_fd() を使って引数に渡された fd_set *
型の変数の内容を自動変数にコピーするようにしています。

ObjectSpace::WeakMap に compact 処理を実装して、要素を pin しなくてすむようにしています。 https://github.com/ruby/ruby/pull/2314

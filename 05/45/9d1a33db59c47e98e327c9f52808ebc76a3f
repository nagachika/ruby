ObjectSpace.define_finalizer の実行中に割り込みがあっても無視されるという不具合
を修正しています。 r40940 あたりで導入した postponed_job の処理の割り込み中のマ
スクに TRAP_INTERRUPT_MASK も追加してみています。おそらく、TRAP_INTERRUPT_MASK
で割り込み自体は遅延されていないのに、実際に割り込まれた時の JUMP_TAG() による
大域脱出のエラーは握り潰されるので(postponed_job では実行中のスレッドとはコンテ
キストの異なる処理をしているので、エラーがあっても伝播しない)、結果割り込みが無
視されるという現象が起きていたので、ちゃんと postponed_job の間は割り込みマスク
して戻ってきた時にあらために割り込み発生させるようにしているのだと思います。
postponed_job に長い処理があるとまずそうですけどね… [ruby-core:66825] [Bug #
10595]

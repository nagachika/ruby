SystemStackError はあらかじめ用意した例外オブジェクトを利用して raise していた
のですが、新たなオブジェクトを割り当てて、r46501 で切り出した rb_obj_copy_ivar
() を利用して複製したものを raise するようにしています。 backtrace の情報をセッ
トするために、元の sysstack_error は freeze しておいて、複製にセットすることで
使いまわした時に古い backtrace が残ってしまわないようにしているようです。チケッ
トをみるとどうも backtrace が1行しか設定されなくなっていたので全部セットするよ
うにしたみたいです。全部あったらそれはそれで長くて大変ですけどね…
[ruby-core:43794] [Feature #6216]

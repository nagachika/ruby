Process.spawn などで最初の引数や最後の引数が Hash だったら環境変数やオプション
として解釈するために rb_check_hash_type() を呼んで to_hash で変換を試みるように
していますが、to_hash が例外を発生させるとエラーになってしまうので、チェック用
の check_hash() という関数を導入して、即値オブジェクトや String や Array の場合
は変換せずに明示的に Qnil を返すようにしています。 [ruby-core:75388] [Bug #
12355]

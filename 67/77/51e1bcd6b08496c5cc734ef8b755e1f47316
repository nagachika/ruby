r59328 で新規追加された Hash#transform_keys! で古いキーの削除のために keys の配
列を参照する時にブロックの呼び出し後はサイズが変更されている可能性があるので、
先に取り出しておくようにしています。
keys は klass=0 にして hidden にしておいたほうがいいかもしれないですね。まあそ
れを言いだすと一時的なオブジェクトを使っているところなんていっぱいあると思いま
すけど。

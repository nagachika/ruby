GC.auto_compact= というメソッドを追加して GC 実行時に自動的に GC.compact によるオブジェクトの移動も行なわれるよう設定可能にしています。おお、ついに。変更内容をみると単にフラグを追加して処理追加してるだけではなくて GC の sweep 処理内に参照の更新対応などがマージされているので結構大きな変更になっています。おそらく安定するまでしばらくかかりそうですね。またついでに GC.stat の返す統計情報に :read_barrier_faults, :total_moved_objects といった項目を追加しています。 read_barrier_faults はなにかなと思ったら GC.compact の処理中にのみ SIGBUS や SIGSEGV のシグナルハンドラに read_barrier_signal() というハンドラが追加されてて、移動したオブジェクトの struct RVALUE の領域を mprotect(2) などで保護して不正なアクセスがあったら検出するようにしているようです。デバッグ用かな?  [ruby-core:100025] [Feature #17176]

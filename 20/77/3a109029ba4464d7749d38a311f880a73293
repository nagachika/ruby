ruby_atomic.h で各種環境/コンパイラの atomic 処理のサポートが得られない場合に表面的な演算のみ模倣するマクロを定義していたのをやめて、#error プラグマでビルドエラーにするようにしています。いつからかなと思ったらこの分岐内にマクロ定義を置いてたのは 9d4e471cf974d99ab01fc243b5419c6711888540 の atomic.h (ruby_atomic.h と改名する前のファイル名)を切り出した時からなのでかなり昔からですね。これで歴史を調べてて気がつきましたが ec10c033a7f6ba4819b7a65eb31eba432028f28a の時にも size_t と VALUE のサイズが異なる時に atomicity の保証されない代替実装をしていたのでこれもまずいかな?

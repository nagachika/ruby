と、思ったら d7fa7e2c860430a3dfa1b08be96734925b6c81d8 の再修正で、rb_enc_str_asciicompat_p() で判定していたのを US-ASCII もしくは UTF-8 であることをチェックするようにしています。これは内容は ASCII compatible なんだけど付与されている Encoding は UTF-8 以外という文字列で変換されなくてエラーになることがあったという修正だそうです。なるほどそっちのほうが問題か。

標準添付ライブラリ net/* の通信処理をまとめている net/protocol で Net::Protocol
#rbuf_consume でバッファつきの読み込み処理で読むサイズが今の @rbuf のサイズと同
じであれば、slice! で変更せずにバッファの文字列オブジェクトをそのまま返し、バッ
ファを空文字列で再初期化するようにしています。slice! が遅いので、とのことですが
slice! でバッファの capacity は変わらない(確保されているメモリサイズが減らない)
可能性もあるので、メモリの節約にもなるようです。 rbuf_consume(@rbuf.size) のよ
うにあるだけ読むという呼びかたをされているところがけっこうあるそうなので、Net::
HTTP を使っている時も結構効くみたいですね。 [ruby-core:84586] [Feature #14268]

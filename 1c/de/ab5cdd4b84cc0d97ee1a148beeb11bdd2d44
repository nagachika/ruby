r37831 で revert された r37826 の再修正です。 r37826 では rb_ary_delete() を使
って WeakMap が内部に保持している配列から参照を消す時にその中で rb_equal() が呼
ばれてしまって死んでいるオブジェクトにメソッドが呼ばれる危険があったようです。
このため array.c に rb_ary_delete_same_obj() という関数を生やして、これを使って
削除するようにしています。これは値の比較を VALUE の比較、つまり同一性で判定して
います。しかしこの関数での rb_ary_modify() の位置はここでいいのかな。まあでも
rb_ary_delete() をベースにしているようなのでいいのでしょう。 [ruby-core:49044]
[Bug #7304]

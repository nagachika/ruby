こんなのあったっけ……と思い出せないのですが RubyVM.USAGE_ANALYSIS_XXX 系の特異メソッド群に USAGE_ANALYSIS_INSN_START、USAGE_ANALYSIS_OPERAND_START、USAGE_ANALYSIS_REGISTER_START、USAGE_ANALYSIS_INSN_RUNNING、USAGE_ANALYSIS_OPERAND_RUNNING、USAGE_ANALYSIS_REGISTER_RUNNING といったメソッドを追加して調査用のフックを有効化できるようにしています。 https://github.com/ruby/ruby/pull/2258
